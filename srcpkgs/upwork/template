# Template file for 'upwork'
pkgname=upwork
version=5.8.0.31
revision=1
_rawver=${version//./_}
_hashver="b7b2c82d2557407d"
_useragent="User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:108.0) Gecko/20100101 Firefox/108.0"
archs="x86_64"
depends="alsa-lib gtk+ GConf gdk-pixbuf nss libXtst libXScrnSaver"
hostmakedepends="curl"
short_desc="Desktop Upwork app"
maintainer="Arthur Evstifeev <mail@ap4y.me>"
license="custom:Upwork"
homepage="https://upwork.com/"
distfiles="https://upwork-usw2-desktopapp.upwork.com/binaries/v${_rawver}_${_hashver}/${pkgname}_${version}_amd64.deb"
_licensefile="https://upwork.pactsafe.io/versions/5ab3efef63d65b6a18aab106.pdf"
checksum="b5057abf453ac71a8197b9d06818574ab73d8affbb48f1df0014e22494039cf2"
repository="nonfree"
restricted=yes
nopie=yes

# Skip runtime dependenies check, otherwise NEEDED libGLESv2.so (which is bundled with the package)
# will trigger dependency on rpi-userland packages (makes no sense on x86_64).
skiprdeps="/opt/${pkgname^}/libEGL.so"

do_fetch() {
	curl -LO --tlsv1.3 -H "${_useragent}" ${distfiles}
	curl -o "LICENSE.pdf" ${_licensefile}
}

do_extract() {
	ar x ${XBPS_BUILDDIR}/${pkgname}_${version}_amd64.deb
	bsdtar xf data.tar.xz
}

do_install() {
	vcopy opt /
	vcopy usr /
	vbin ${FILESDIR}/${pkgname}
	vlicense ${XBPS_BUILDDIR}/LICENSE.pdf
}
